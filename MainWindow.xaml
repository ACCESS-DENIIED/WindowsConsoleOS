<Window x:Class="WindowSelector.MainWindow"
        Activated="Window_Activated"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:WindowSelector"
        Title="MainWindow" Height="350" Width="600"
        AllowsTransparency="True"
        WindowStyle="None"
        Background="Transparent">

    <Window.Resources>
        <local:LazyImageLoader x:Key="LazyImageLoader"/>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <!-- Allocate 1/3 of the space for the ListBox and item names -->
            <ColumnDefinition Width="1*"/>
            <!-- Allocate 2/3 of the space for the preview image -->
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <ListBox VirtualizingStackPanel.IsVirtualizing="True"
         VirtualizingStackPanel.VirtualizationMode="Recycling"
         Background="Transparent" 
         BorderThickness="0" 
         x:Name="WindowListBox" 
         HorizontalAlignment="Stretch" 
         VerticalAlignment="Stretch" 
         Margin="10" 
         SelectionChanged="WindowListBox_SelectionChanged" 
         Grid.Column="0">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Grid Background="Transparent">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="50"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <!-- Icon -->
                        <Image Width="40" Height="40" Margin="5,0,5,0" Source="{Binding Icon}" Grid.Column="0"/>
                        <!-- TextBlock for Name -->
                        <TextBlock Text="{Binding Name}" FontSize="72" Foreground="White" Margin="5,0" VerticalAlignment="Center" Grid.Column="1"/>
                    </Grid>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <!-- Enhanced Preview Image with Rounded Edges and Shadow -->
        <Border Background="Transparent" Grid.Column="1" Margin="10" CornerRadius="1" VerticalAlignment="Top" HorizontalAlignment="Right" Padding="5">
            <Border.Effect>
                <DropShadowEffect Color="Black" Direction="320" ShadowDepth="5" BlurRadius="10" Opacity="0.5"/>
            </Border.Effect>
            <Image x:Name="PreviewImage" Source="{Binding SelectedItem.WindowHandle, ElementName=WindowListBox, Converter={StaticResource LazyImageLoader}}" Stretch="Uniform"/>
        </Border>
        <Image Source="Legend.png" HorizontalAlignment="Right" VerticalAlignment="Bottom" Width="600" Margin="10" Grid.ColumnSpan="2" />
    </Grid>
</Window>